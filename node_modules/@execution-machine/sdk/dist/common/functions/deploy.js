"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.deployFunction = void 0;
const model_1 = require("../model");
const commons_1 = require("../utils/commons");
const vars_1 = require("../vars");
const deployOpFailure_1 = require("../exceptions/deployOpFailure");
const deployFunction = async (contractSrc, contractInitState, contractType, emToken, opts) => {
    try {
        const bytes = Array.from(contractSrc.values());
        const body = {
            contractSrc: bytes
        };
        body.contentType = contractType || model_1.ContractType.JS;
        body.initState = contractInitState;
        body.contractOwner = (opts || {}).ownerAddress || "";
        const data = await (0, commons_1.postRequest)(`${vars_1.EmVars.EM_BACKEND_URL}/contract/deploy?token=${emToken}`, body);
        if (data.ok) {
            const json = await data.json();
            return json;
        }
        else {
            throw new deployOpFailure_1.DeployOpFailure(`${data.status}: Function application could not be deployed.`, data.status);
        }
    }
    catch (e) {
        if (e instanceof deployOpFailure_1.DeployOpFailure) {
            throw e;
        }
        else {
            throw new deployOpFailure_1.DeployOpFailure(`${e.toString()}`);
        }
    }
};
exports.deployFunction = deployFunction;
//# sourceMappingURL=deploy.js.map